# .envrc

# --- Begin mobile API URL auto-detect ---

# macOS mDNS hostname (works great for iOS devices on same Wi-Fi)
get_mdns_host() {
  if command -v scutil >/dev/null 2>&1; then
    local h; h=$(scutil --get LocalHostName 2>/dev/null || true)
    if [ -n "$h" ]; then
      echo "${h}.local"
      return 0
    fi
  fi
  return 1
}

# Cross-platform best-effort LAN IPv4
get_lan_ip() {
  # macOS
  if command -v ipconfig >/dev/null 2>&1; then
    ipconfig getifaddr en0 2>/dev/null || ipconfig getifaddr en1 2>/dev/null || true
    return 0
  fi
  # Linux (requires iproute2)
  if command -v ip >/dev/null 2>&1; then
    ip -4 route get 1.1.1.1 2>/dev/null | awk '{print $7; exit}'
    return 0
  fi
  # Fallback
  hostname -I 2>/dev/null | awk '{print $1}' || true
}

API_HOST="$(get_mdns_host || get_lan_ip)"
API_PORT="${API_PORT:-5050}"

# Export what the phone should call
if [ -n "$API_HOST" ]; then
  export EXPO_PUBLIC_API_URL="http://${API_HOST}:${API_PORT}"
else
  # Last resort; emulators will still work via code fallbacks
  export EXPO_PUBLIC_API_URL="http://127.0.0.1:${API_PORT}"
fi

# --- End mobile API URL auto-detect ---

use flake ./dev
dotenv dev/.env

echo "EXPO_PUBLIC_API_URL ${EXPO_PUBLIC_API_URL}"
echo "ðŸ”” direnv: entering $(pwd)"